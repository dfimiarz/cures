{% extends "base.template.twig" %}

{% import "form.html.twig" as form %}

{% block title %}
    CURES - Submitt a work order
{% endblock %}

{% block styles %}
    {{parent()}}


    <style>
        #detailed-stats-pannel{
            display: none;
        };

    </style>

{% endblock %}

{% block dynamicMenuContent %}
{% endblock %}

{% block content %}

    <section>
        <div class="container">

            <div class="hero">
                <div class="hero-body">
                    <div class="container">
                        <h1 class="title">
                            Add a work request
                        </h1>
                        <h2 class="subtitle">
                            Fill out the form below
                        </h2>
                    </div>
                </div>
            </div>


            <form>
                <div class="columns">
                    <div class="column is-10-mobile is-offset-1-mobile is-6-desktop is-offset-3-desktop">
                        <div class="message is-info">
                            <div class="message-header">
                                <p>Info</p>
                                <button class="delete" aria-label="delete"></button>
                            </div>
                            <div class="message-body">
                                Emergancy? Please call (555) 555-5555
                            </div>
                        </div>
                    </div>
                </div>

                {% if formcontent.errors is defined %}
                    <div class="columns">
                        <div class="column is-10-mobile is-offset-1-mobile is-6-desktop is-offset-3-desktop">
                            <div class="message is-danger">
                                <div class="message-header">
                                    <p>Error</p>
                                    {#<button class="delete" aria-label="delete"></button>#}
                                </div>
                                <div class="message-body">
                                    Error submitting form
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}

                <div class="columns">
                    <div class="column is-10-mobile is-offset-1-mobile is-6-desktop is-offset-3-desktop">
                        {% set fieldAttributes = 
                                {
                                    "type" : "input",
                                    "subtype" : "text",
                                    "name" : "type",
                                    "lbl" : "Request type:", 
                                    "value" : "",
                                    "placeholder" : "e.g Leak",
                                    "required" : "required"
                                }   
                        %}

                        {{ form.field(fieldAttributes,_context) }}
                    </div>
                </div>

                <div class="columns">
                    <div class="column is-10-mobile is-offset-1-mobile is-6-desktop is-offset-3-desktop">
                        {% set fieldAttributes = 
                                {
                                    "type" : "input",
                                    "subtype" : "text",
                                    "name" : "location",
                                    "lbl" : "Location:", 
                                    "value" : "",
                                    "placeholder" : "e.g MR 1320",
                                    "required" : "required"
                                }   
                        %}

                        {{ form.field(fieldAttributes,_context) }}
                    </div>
                </div>
                <div class="columns">
                    <div class="column is-10-mobile is-offset-1-mobile is-6-desktop is-offset-3-desktop">
                        <div class="form-check">
                            <label class="form-check-label">
                                <input type="checkbox" class="form-check-input" name="urgent">
                                Urgent request. Explain below
                            </label>
                        </div>
                    </div>
                </div>
                <div class="columns">
                    <div class="column is-10-mobile is-offset-1-mobile is-6-desktop is-offset-3-desktop">
                        {% set fieldAttributes = 
                                {
                                    "type" : "textarea",
                                    "name" : "details",
                                    "lbl" : "Details:", 
                                    "value" : "",
                                    "required" : "required"
                                }   
                        %}

                        {{ form.field(fieldAttributes,_context) }}
                    </div>
                </div>
                <div class="columns">
                    <div class="column is-10-mobile is-offset-1-mobile is-6-desktop is-offset-3-desktop">
                        <label for="wo_image">Attach an image (optional)</label>
                        <input class="form-control-file show-for-sr" type="file" id="req_image" name="image" accept=".png, .jpg, .jpeg">
                    </div>
                </div>
                <div class="columns">
                    <div class="column is-10-mobile is-offset-1-mobile is-6-desktop is-offset-3-desktop">
                        {% set fieldAttributes = 
                                {
                                    "type" : "input",
                                    "subtype" : "text",
                                    "name" : "name",
                                    "lbl" : "Your name:", 
                                    "value" : "",
                                    "placeholder" : "",
                                    "required" : "required"
                                }   
                        %}

                        {{ form.field(fieldAttributes,_context) }}

                    </div>
                </div>
                <div class="columns">
                    <div class="column is-10-mobile is-offset-1-mobile is-6-desktop is-offset-3-desktop">
                        <label for="req_dept_sel"> Department:  </label>    
                        <select class="form-control custom-select " id="req_dept_sel" name="dept" required>
                            <option value="biology">Biology</option>
                            <option value="chemistry">Chemistry</option>
                            <option value="eas">EAS</option>
                            <option value="mathematics">Mathematics</option>
                            <option value="physics">Physics</option>
                            <option value="other">Other</option>
                        </select>
                        <div class="invalid-feedback">
                            Invalid department
                        </div>
                    </div>
                </div>
                <div class="columns">
                    <div class="column is-10-mobile is-offset-1-mobile is-6-desktop is-offset-3-desktop">
                        {% set fieldAttributes = 
                                {
                                    "type" : "input",
                                    "subtype" : "text",
                                    "name" : "phone",
                                    "lbl" : "Phone #:", 
                                    "value" : "",
                                    "placeholder" : "",
                                    "required" : "required"
                                }   
                        %}

                        {{ form.field(fieldAttributes,_context) }}
                    </div>
                </div>
                <div class="columns">
                    <div class="column is-10-mobile is-offset-1-mobile is-6-desktop is-offset-3-desktop">
                        {% set fieldAttributes = 
                                {
                                    "type" : "input",
                                    "subtype" : "text",
                                    "name" : "email",
                                    "lbl" : "E-mail address:", 
                                    "value" : "",
                                    "placeholder" : "",
                                    "required" : "required"
                                }   
                        %}

                        {{ form.field(fieldAttributes,_context) }}

                    </div>
                </div>
                <div class="columns">
                    <div class="column is-10-mobile is-offset-1-mobile is-6-desktop is-offset-3-desktop">
                        <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" name="reme">
                            Remember me
                        </label>

                    </div>
                </div>
                <div class="columns">
                    <div class="column is-10-mobile is-offset-1-mobile is-6-desktop is-offset-3-desktop">
                        <button type="submit" class="btn btn-primary" id="submit_btn">Submit</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</section>
{% endblock %} 

{% block javascript %}
    {{parent()}}
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>

        var workRequest = {

            requester: "",
            phone: "",
            email: "",
            dept_id: "",
            type: "",
            location: "",
            urgent: 0,
            desc: "",
            inst: ""

        };

        $(document).ready(function () {


            $("#type_field_widget").autocomplete(
                    {
                        source: "{{ path('getRequestTypes') }}",
                        minLength: 2,
                        select: function (event, ui) {
                            alert("Will get stats for " + ui.item.value);
                        }
                    }
            );


            $("#location_field_widget").autocomplete(
                    {
                        source: "{{ path('getLocations') }}",
                        minLength: 2
                    }
            );


            $('#reqform').submit(function (event) {

                console.log("Will submit");

                var form = document.getElementById("reqform");

                if (form.checkValidity() == false) {
                    event.preventDefault();
                }

            });
        });

    </script>
{% endblock %} 


